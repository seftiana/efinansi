<!-- patTemplate:tmpl name="content" -->
<style>
    .title-label {
        padding: 8px 0 3px 10px;
        float: left;
    }    
    
    .btn-title {
        padding: 3px 0 3px 10px;
        float: right;
    }
</style>
<h1><!-- patTemplate:gtfwgetconfig config="language" name="manajemen_kelompok_laporan" / --></h1>
<br/>
 
   <!-- patTemplate:tmpl name="warning_box" visibility="hidden" -->
   <div class="notebox-alert">
      {ISI_PESAN}
   </div>
   <br/>
   <!-- /patTemplate:tmpl -->
   <form method="POST" action="{URL_ACTION}" class="xhr_form std_form" id="frmInput" name="frmInput" >    
   <input type="hidden" name="kellap_id" value="{DATA_KELLAP_ID}"  />
   <input type="hidden" name="kellap_tipe" value="{DATA_KELLAP_TIPE}"  />
   <input type="hidden" name="kellap_kode_sistem" value="{DATA_KELLAP_KODE_SISTEM}"  />
   <input type="hidden" name="kellap_level" value="{DATA_KELLAP_LEVEL}"  />
      <table class="table-edit" width="100%">
         <tr class="subhead">
            <th colspan="2">{JUDUL} <!-- patTemplate:gtfwgetconfig config="language" name="kelompok_laporan" / -->
                <input type="hidden" name="kellap_pid" value="{DATA_KELLAP_PID}" id="kellap_pid" />
                <input type="hidden" name="kellap_parent_id" value="{DATA_KELLAP_PARENT_ID}" id="kellap_parent_id" />
                <input type="hidden" name="kellap_parent_tipe" value="{DATA_KELLAP_PARENT_TIPE}" id="kellap_parent_tipe" />                
                <input type="hidden" name="kellap_parent_nama" value="{DATA_KELLAP_PARENT_NAMA}" id="kellap_parent_nama" />                                  
                <input type="hidden" name="kellap_parent_kode_sistem" value="{DATA_KELLAP_PARENT_KODE_SISTEM}" id="kellap_parent_kode_sistem" />   
                <input type="hidden" name="kellap_parent_level" value="{DATA_KELLAP_PARENT_LEVEL}" id="kellap_parent_level" />   
            </th>
         </tr>
         <tr style="display: none">
            <th>Parent</th>
            <td>
                <!-- patTemplate:tmpl name="root_data" type="condition" conditionvar="DATA_EMPTY" -->
                    <!-- patTemplate:sub condition="YES" -->
                        -
                    <!-- /patTemplate:sub -->
                    <!-- patTemplate:sub condition="NO" -->
                        <!-- patTemplate:tmpl name="root_data_item" -->
                        <span style="padding-left: {KELLAP_PADDING}px">{KELLAP_NAMA}</span><br />
                        <!-- /patTemplate:tmpl -->
                   <!-- /patTemplate:sub -->
                <!-- /patTemplate:tmpl -->
                         
            </td>
         </tr>
         <tr>
            <th width="150">Label Summary</th>
            <td>
                <input type="text" name="kellap_nama" value="{DATA_KELLAP_NAMA}" size="40" />&nbsp;*<br />
                <small><i>(contoh : Jumlah Nama Kelompok Laporan)</i></small>
            </td>
         </tr>
         <tr>
            <th>
                <!-- patTemplate:gtfwgetconfig config="language" name="no_urut" / -->
            </th>
            <td id="no_urutan">
               <input type="hidden" name="kellap_no_akhir" value="{DATA_KELLAP_NO_AKHIR}" id="kellap_no_akhir" />
               <input type="text" name="kellap_no_selanjutnya" value="{DATA_KELLAP_NO_SELANJUTNYA}" size="5" class="gvNum" id="kellap_no_selanjutnya" />&nbsp;*
               (<!-- patTemplate:gtfwgetconfig config="language" name="no_urutan_terakhir" / --> : {KELLAP_NO_AKHIR})
            </td>            
         </tr>

        
         <tr>
             <th width="150" rowspan="2">Operasi Perhitungan</th>
            <td>
                <input type="radio" id="kellap_op_basic" name="kellap_operasi_perhitungan" {DATA_OP_BASIC_CHECKED} value="0" onchange="javascript:onClickPerhitunganBasic();"/>Perhitungan dalam kelompok <br />
                <div style="padding-left: 30px;" ><b><i>{DATA_KELLAP_PARENT_NAMA}</i></b></div>
            </td>
         </tr>
         <tr>
             <td>
                 <input type="radio" id="kellap_op_adv" name="kellap_operasi_perhitungan" {DATA_OP_ADV_CHECKED} value="1" onchange="javascript:onClickPerhitunganAdvance();" />Perhitungan Advance
             </td>
         </tr>
        <tr>
            <td colspan="2" class="links">     
                <div class="title-label">                    
                Daftar referensi sub kelompok laporan :                 
                </div>
                <div class="btn-title">                 
                    <a class="dest_subcontent-element" href="javascript:void(0)" onclick="javascript:onGetSubKelompokLaporan();" title="Tampilkan Sub Kelompok">
                       <img src="images/icons/16/detail.gif" style="margin-bottom: -4px;" />
                       <b>Refresh Sub Kelompok</b>
                    </a>
                   
                </div>
            </td>
        </tr>
        <tr>
            <td colspan="2"  style="padding: 0px; margin: 0px;">
                
                <table class="table-common" style="width: 100%;">
                    <thead>
                        <tr>
                             <th >
                                Kelompok Laporan
                             </th>
                             <th style="width: 30px;">
                                <!-- patTemplate:gtfwgetconfig config="language" name="aksi" / -->
                             </th>
                          </tr>
                    </thead>
                    <tbody id="KlpPlaceHolder">
                        <tr id="klp-empty-row">
                             <td colspan="2" style="text-align: center;font-style: italic;">
                                -- Referensi Kelompok Laporan Tidak Ada -- 
                             </td>
                        </tr>
                    </tbody>
                </table>
            </td>
        </tr>
         <tr class="buttons">
            <th>&nbsp;
            </th>
            <td>
               <input type="submit" name="btnsimpan" value=" <!-- patTemplate:gtfwgetconfig config="language" name="simpan" / --> " class="buttonSubmit"/>
               <input  type="submit"  name="btnbalik" value=" <!-- patTemplate:gtfwgetconfig config="language" name="batal" / --> " class="buttonSubmit"/>
            </td>
         </tr>
      </table>
   </form>
   
   <br/>
   
   <div class="petunjuk-area">
      <h4><!-- patTemplate:gtfwgetconfig config="language" name="petunjuk" / -->:</h4>
      <ul>
         <li><!-- patTemplate:gtfwgetconfig config="language" name="info_wajib_diisi" / --></li>
         
      </ul>
   </div>
<script type="text/javascript">


// untnuk kelompok laporan
document.getElementById('KlpPlaceHolder').addItem     = function( id,nama,padding,level,isChild){
    
   var elemen_id  = 'klp_laporan_'+id;
   if(document.getElementById(elemen_id)){
      return true;
   }
   var frag             = document.createDocumentFragment();
   var childObj         = this.getElementsByTagName('tr');

   for (var i = childObj.length - 1; i >= 0; i--) {
      if(childObj[i].id === 'klp-empty-row' || childObj[i].id == 'row-klp-total'){
         this.removeChild(childObj[i]);
      }
   };

   var tr      = document.createElement('tr');
   tr.id       = elemen_id;

   var inputId       = document.createElement('input');
   inputId.type      = 'hidden';
   inputId.id        = 'klp-id-'+id;
   inputId.name      = 'klp['+id+'][id]';
   inputId.value     = id;

   var tdNama        = document.createElement('td');
   var inputNama     = document.createElement('input');
   inputNama.type    = 'hidden';
   inputNama.id      = 'klp-nama-'+id;
   inputNama.name    = 'klp['+id+'][nama]';
   inputNama.value   = nama;
   var inputIsChild     = document.createElement('input');
   inputIsChild.type    = 'hidden';
   inputIsChild.id      = 'klp-is_child-'+id;
   inputIsChild.name    = 'klp['+id+'][is_child]';
   inputIsChild.value   = isChild;
   var inputLevel     = document.createElement('input');
   inputLevel.type    = 'hidden';
   inputLevel.id      = 'klp-level-'+id;
   inputLevel.name    = 'klp['+id+'][level]';
   inputLevel.value   = level;
   var labelNama     = document.createElement('label');
   labelNama.innerHTML  = nama;
   labelNama.setAttribute('style','padding-left: '+ padding +'px');
   //added component to column
   tdNama.appendChild(inputId);
   tdNama.appendChild(inputNama);
   tdNama.appendChild(inputIsChild);
   tdNama.appendChild(inputLevel);
   tdNama.appendChild(labelNama);


   var tdAksi        = document.createElement('td');
   tdAksi.className  = 'links';
   tdAksi.style.padding       = 0;
   tdAksi.style.paddingTop    = '4px';
   tdAksi.style.textAlign     = 'center';
   var linkAksiDelete         = document.createElement('a');
   linkAksiDelete.style.float = 'none';
   linkAksiDelete.style.display = 'inline-block';
   linkAksiDelete.href        = 'javascript:void(0);';
   linkAksiDelete.title       = 'Delete '+id;
   linkAksiDelete.setAttribute('onclick', 'deleteRecord("'+this.id+'", this);');
   var iconDelete             = document.createElement('img');
   iconDelete.src             = 'images/icons/16/button-delete.gif';
   iconDelete.alt             = 'delete';

   linkAksiDelete.appendChild(iconDelete);
   tdAksi.appendChild(linkAksiDelete);
        
   tr.appendChild(tdNama);
   tr.appendChild(tdAksi);

   frag.appendChild(tr);   
   this.appendChild(frag);
   return true;
}

var deleteRecord     = function(elemenId, el){
   var tBody         = document.getElementById(elemenId);
   if(typeof(tBody) !== 'undefined' && tBody !== null){
      var emptyRow   = 'klp-empty-row';
      var totalRow   = 'row-klp-total';

      var record        = el.parentNode.parentNode;
      var firstNode     = tBody.firstChild.nextSibling;
      var childObj      = tBody.getElementsByTagName('tr');

      if(firstNode.id !== emptyRow || firstNode.id !== totalRow){
         tBody.removeChild(record);
         if(childObj.length === 0){
            setEmptyRecord(tBody);
         }else{
            if(childObj[0].id === totalRow){
               setEmptyRecord(tBody);
            }
         }
      }else{
         setEmptyRecord(tBody);
      }
   }else{
      console.log('Cannot find HTML elemen');
   }
}

var setEmptyRecord      = function(elemen){
   var emptyRow   = 'klp-empty-row';


   var childObj   = elemen.getElementsByTagName('tr');
   for (var i = childObj.length - 1; i >= 0; i--) {
      elemen.removeChild(childObj[i]);
   };

   var frag       = document.createDocumentFragment();
   var tr         = document.createElement('tr');
   tr.id          = emptyRow;
   var td         = document.createElement('td');
   td.setAttribute('colspan', 2);
   td.style.textAlign   = 'center';
   td.style.fontStyle    = 'italic';
   td.innerHTML   = '-- Referensi Kelompok Laporan Tidak Ada --';

   tr.appendChild(td);
   frag.appendChild(tr);
   elemen.insertBefore(frag, elemen.firstChild);

   return true;
}

document.getElementById('KlpPlaceHolder').deleteAllItem = function ()
{
   var Obj        = this.getElementsByTagName('tr');
   var emptyRow   = document.createElement('tr');
   emptyRow.id    = 'klp-empty-row';
   var tdEmpty    = document.createElement('td');
   tdEmpty.setAttribute('colspan', '2');
   tdEmpty.style.textAlign    = 'center';
   tdEmpty.style.fontStyle    = 'italic';
   tdEmpty.innerHTML          = '-- Referensi Kelompok Laporan Tidak Ada -- ';
   emptyRow.appendChild(tdEmpty);

   for (var i = Obj.length - 1; i >= 0; i--) {
      this.removeChild(Obj[i]);
   };
   this.appendChild(emptyRow);
};

var getSubKelompokLaporanFromData = function() {
 var dataKLPAll       = {SUB_KLP_DATA_ALL};
    if(dataKLPAll.length > 0){
       for(var i in dataKLPAll){
          document.getElementById('KlpPlaceHolder').addItem(              
             dataKLPAll[i].id,
             dataKLPAll[i].nama,
             dataKLPAll[i].padding,
             dataKLPAll[i].level,
             dataKLPAll[i].is_child
          );
       }
    }
}

var getSubKelompokLaporan = function() {
 var dataKLP       = {SUB_KLP_DATA};
    if(dataKLP.length > 0){
       for(var i in dataKLP){
          document.getElementById('KlpPlaceHolder').addItem(              
             dataKLP[i].id,
             dataKLP[i].nama,
             dataKLP[i].padding,
             dataKLP[i].level,
             dataKLP[i].is_child
          );
       }
    }
}
var onGetSubKelompokLaporan = function(){    
    

    if(document.getElementById('kellap_op_adv')) {    
       var valueOperasi =  document.getElementById('kellap_op_adv').checked;
       if(valueOperasi == true){
           document.getElementById('KlpPlaceHolder').deleteAllItem();
           getSubKelompokLaporanFromData();
       } else {
           alert('Refresh Sub Kelompok Hanya Untuk Perhitungan Advance');
       }
    }
};

var onClickPerhitunganBasic = function() {
    document.getElementById('KlpPlaceHolder').deleteAllItem();
};

var onClickPerhitunganAdvance = function(){
    onGetSubKelompokLaporan();
};

if(document.getElementById('kellap_op_adv')) {    
   var valueOperasi =  document.getElementById('kellap_op_adv').checked;
   if(valueOperasi == true){
       getSubKelompokLaporan();
   }
}
</script>

<!-- /patTemplate:tmpl -->