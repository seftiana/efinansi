<!-- patTemplate:tmpl name="content" -->
<script language="javascript" type="text/javascript" src="js/cookie.js"></script>
<script language="javascript" type="text/javascript">
   var file_attach_nomor = 2;
   var nomor_invoice_list = 0;
   var arr_invoice_list = new Array();
   var xpopup;

   //getButton('hapus', 'http://ddd','test()')
   function getButton(xjenis, xhref, xonclick) {
      var xlink = document.createElement('a');
      var gbr = document.createElement('img');
      if(xjenis == 'hapus' || xjenis == 'delete') {
         xlink.setAttribute("title", "Hapus");
         gbr.setAttribute("src", "images/button-delete.gif");
         gbr.setAttribute("alt", "Hapus");
      } else {
         //edit
         xlink.setAttribute("title", "Edit");
         gbr.setAttribute("src", "images/button-edit.gif");
         gbr.setAttribute("alt", "Edit");
      }
      xlink.setAttribute("class", "xhr dest_subcontent-element");
      xlink.setAttribute("href", xhref);
      xlink.setAttribute("onclick", xonclick);
      xlink.appendChild(gbr);
      return xlink;
   }

   function buatBaris(xId, isiNomor, objIsi, objAksi) {
      var tr = document.createElement('tr');
      var td_nomor = document.createElement('td');
      var td_isi = document.createElement('td');
      var td_aksi = document.createElement('td');
      var nomor = document.createTextNode(isiNomor+1);

      tr.setAttribute("id", "tr_" + xId + "_" + isiNomor);
      td_nomor.align = "center";
      //alert(isiNomor);
      td_nomor.appendChild(nomor);
      //td_isi.setAttribute("title", "666");
      td_isi.appendChild(objIsi);
      td_aksi.appendChild(objAksi);

      //tr.appendChild(td_nomor);
      tr.appendChild(td_isi);
      tr.appendChild(td_aksi);
      return tr;
   }

   function tambahInvoice() {

      //membuat isi elemen2
      var isi;
      var isi_container;
      //membuat input hidden
      var input_hidden;

      var button_hapus;
      var baris;

      var tbodi = document.getElementById("tbody_invoice_list");
      var obj = document.getElementById('no_invoice');

      input_hidden = document.createElement('input');
      input_hidden.type = 'hidden';
      input_hidden.name = 'no_invoice_list[]';
      input_hidden.value = obj.value;

      isi = document.createTextNode(obj.value);
      isi_container = document.createElement('div');
      isi_container.appendChild(isi);
      isi_container.appendChild(input_hidden);

      button_hapus = getButton("hapus", "javascript:void(0)", "hapusInvoice(this)");

      baris = buatBaris('invoice_list', '', isi_container, button_hapus);
      tbodi.appendChild(baris);
      if(document.getElementById('invoice_empty'))
         document.getElementById('invoice_empty').style.display='none';
      obj.value='';
   }

   function hapusInvoice(obj) {
      document.getElementById("tbody_invoice_list").removeChild(obj.parentNode.parentNode);
   }

   function hapusInvoiceEdit(obj, xid) {
      var tr = obj.parentNode.parentNode;
      //membuat input hidden untuk dihapus
      var input_hidden;
      input_hidden = document.createElement('input');
      input_hidden.type = 'hidden';
      input_hidden.name = 'no_invoice_list_delete[]';
      input_hidden.value = xid;
      document.forms['frmInput'].appendChild(input_hidden);
      tr.parentNode.removeChild(tr);
   }

   function uploadFile(obj) {
      var arr_namafile = obj.value.split("\\");
      var namafile = arr_namafile[(arr_namafile.length-1)];

      //membuat elemen2
      var tr = document.createElement('tr');
      var td_nomor = document.createElement('td');
      var td_isi = document.createElement('td');
      var td_aksi = document.createElement('td');

      //membuat input file baru
      var input_file = document.createElement('input');
      input_file.setAttribute("type", "file");
      input_file.setAttribute("readonly", "true");
      input_file.setAttribute("name", "file_attach[]");
      input_file.setAttribute("onchange", "uploadFile(this)");
      input_file.id = "file_attach_" + file_attach_nomor;
      obj.parentNode.appendChild(input_file);

      //menyembunyikan yang lama
      obj.setAttribute("style", "display:none");

      //membuat isi elemen2
      var nomor = document.createTextNode(file_attach_nomor-1);
      var isi = document.createTextNode(namafile);

      //mengisikan elemen2 dengan isinya
      tr.setAttribute("id", "tr_file_bohong_" + (file_attach_nomor-1));
      td_nomor.setAttribute("align", "center");
      td_nomor.appendChild(nomor);
      td_isi.setAttribute("title", obj.value);
      td_isi.appendChild(isi);
      //td_isi.appendChild(input_file);

      //untuk tombol deletenya
      var button_hapus = getButton("hapus", "javascript:void(0)", "hapusFile('" + (file_attach_nomor-1) + "')");
      td_aksi.appendChild(button_hapus);

      //tr.appendChild(td_nomor);
      tr.appendChild(td_isi);
      tr.appendChild(td_aksi);
      document.getElementById('file_attach_tbody').appendChild(tr);
      if(document.getElementById('file_empty'))
         document.getElementById('file_empty').style.display='none';
      file_attach_nomor++;
   }

   function hapusFile(xid) {
      var elem = document.getElementById("tr_file_bohong_" + xid);
      elem.parentNode.removeChild(elem);
      var elem2 = document.getElementById("file_attach_" + xid);
      elem2.parentNode.removeChild(elem2);
   }

   function hapusFileEdit(obj, valId, valNama) {
      var tr = obj.parentNode.parentNode;
      tr.setAttribute('style', 'display:none');
      //membuat input hidden untuk dihapus
      var input_hidden;
      input_hidden = document.createElement('input');
      input_hidden.type = 'hidden';
      input_hidden.name = 'file_attach_delete[]';
      input_hidden.value = valId;
      var input_hidden2;
      input_hidden2 = document.createElement('input');
      input_hidden2.type = 'hidden';
      input_hidden2.name = 'file_attach_delete_nama[]';
      input_hidden2.value = valNama;
      obj.parentNode.appendChild(input_hidden);
      obj.parentNode.appendChild(input_hidden2);
   }

   function hapusSkenarioBohong(xid) {
      var elem = document.getElementById(xid);
      elem.parentNode.removeChild(elem);
   }

   function bukaPopupSkenario(xurl) {
      showPopup(xurl,'',600,500);
   }
   function bukaPopupUnitkerja(xurl) {
      showPopup(xurl,'',600,500);
   }
   function bukaPopupMAK(xurl) {
      var
         uk = document.getElementById('unitkerja'),
         jenis_trans = document.getElementById('jenis_transaksi'),
         tipe_trans = document.getElementById('tipe_transaksi');
      if(!uk.value) alert('Silakan Pilih Unitkerja');
      else {
        /* if(jenis_trans.value == '5' && tipe_trans.value == '1')
            showPopup('{URL_POPUP_MAK_PENERIMAAN}' + '&unitkerja=' + uk.value,'',600, 500);
         else if (jenis_trans.value == '5' && tipe_trans.value == '4')
            showPopup('{URL_POPUP_KEGIATAN_UNIT_KERJA}' + '&unitkerja=' + uk.value,'',600, 500);
         else if (jenis_trans.value == '5' && tipe_trans.value == '5')
            showPopup('{URL_POPUP_SISA_ANGGARAN}' + '&unitkerja=' + uk.value,'',600, 500);
         else */
        showPopup(xurl + '&unitkerja=' + uk.value,'',600, 500);
      }
   }

   var showHideMAK = function (obj) {
      tipe_transaksi = document.getElementById('tipe_transaksi');
      if (!showHideMAK.stack) showHideMAK.stack = new Array;

      if(obj.options[obj.selectedIndex].text != 'Anggaran') {
         for (i = tipe_transaksi.options.length - 1; i >= 0; i--)
            if (tipe_transaksi.options[i].value == 4 || tipe_transaksi.options[i].value == 5)
            {
               if (tipe_transaksi.selectedIndex == i)
                  //tipe_transaksi.onchange();
               showHideMAK.stack[tipe_transaksi.options[i].value] = tipe_transaksi.options[i].text;
               tipe_transaksi.options[i] = null;
            }

         document.getElementById('mak').value = '';
         document.getElementById('mak_label').value = '';
         document.getElementById('mak_label').disabled = true;
         document.getElementById('but_mak').disabled = true;
         document.getElementById('nominal_disetujui').disabled = true;
      } else {
         document.getElementById('mak_label').disabled = false;
         document.getElementById('but_mak').disabled = false;
         document.getElementById('nominal_disetujui').disabled = false;
         for (i in showHideMAK.stack) if (showHideMAK.stack[i])
            tipe_transaksi.options[tipe_transaksi.options.length] = new Option(showHideMAK.stack[i], i);
         showHideMAK.stack = new Array;
      }

      if (window.event)
      {
         //document.getElementById('nominal').value = '';
         document.getElementById('nominal').removeAttribute('readonly');
      }
   }

   function cek(objId, msg) {
      var obj = document.getElementById(objId);
      if(!obj.value && !obj.disabled) {
         alert(msg);
         obj.focus();
         obj.select;
         return false;
      }
      return true;
   }

   function ceknominal(objId1, objId2, msg) {
      var obj1 = document.getElementById(objId1);
      var obj2 = document.getElementById(objId2);
      obj1Val = parseInt(obj1.value);
      obj2Val = parseInt(obj2.value);

      if (obj1.gvGetValue) obj1Val = parseInt(obj1.gvGetValue());
      if (obj2.gvGetValue) obj2Val = parseInt(obj2.gvGetValue());

      if(obj1Val > obj2Val) {
         alert(msg);
         obj1.focus();
         obj1.select;
         return false;
      }
      return true;
   }

   function cekIsiForm() {
      if(false == cek('unitkerja', 'Silakan isi Unit/ Sub Unit')) return;
     // if(false == cek('jenis_transaksi', 'Silakan isi Jenis Transaksi')) return;
     // if(false == cek('tipe_transaksi', 'Silakan isi Tipe Transaksi')) return;
      var jenis = document.getElementById('jenis_transaksi');
      if(jenis.value == 5 && !cek('mak', 'Silakan Pilih Mata Anggaran')) return;
      //if(false == cek('no_kkb', 'Silakan isi Nomor BKK')) return;
     // if(!document.getElementsByName('no_invoice_list[]').length && !document.getElementsByName('no_invoice_list_edit').length) {alert('Silahkan isi invoice!'); document.getElementById('no_invoice').focus(); return;}
      if(false == cek('nominal', 'Silakan isi Nominal Transaksi')) return;
      if(jenis.value == 5 && !ceknominal('nominal','nominal_disetujui_hidden', 'Nilai Nominal tidak boleh lebih dari nilai Nominal Disetujui.')) return;
      if(false == cek('penanggung_jawab', 'Silakan isi Penanggung Jawab')) return;
      if(false == cek('skenario', 'Silakan Pilih Skenario yang digunakan')) return;

      document.getElementById('simpan').click();
   }
/**
   function jsCheck(idTipe) {
      var jenis = document.getElementById('jenis_transaksi').value;
      var tipe = document.getElementById('tipe_transaksi').value;
      var unitkerja_label = document.getElementById('unitkerja_label').value;
      var unitkerja = document.getElementById('unitkerja').value;

      GtfwAjax.replaceContentWithUrl('no_bkk', '<!-- patTemplate:gtfwgeturl module="transaksi_realisasi" sub="no" action="view" type="html" htmlentities="no" / -->&ascomponent=1&dataId='+idTipe+'&check=yes&jenis_transaksi='+jenis+'&tipe_transaksi='+tipe+'&unitkerja='+unitkerja);
      //document.forms[0].check.value = "yes";
      //document.forms[0].submit();
   }
   */
</script>
<h1><!-- patTemplate:gtfwgetconfig config="language" name="transaksi_realisasi_pencairan" / --></h1>

   <br />
   <!-- patTemplate:tmpl name="warning_box" visibility="hidden" -->
   <div class="{CLASS_PESAN}">
      {ISI_PESAN}
   </div>
    <br />
   <!-- /patTemplate:tmpl -->

  
   <form method="POST" action="{URL_ACTION}" name="frmInput" class="xhr_form std_form" id="frmInput" enctype="multipart/form-data" >
      <input type="hidden" name="check" id="check" value="" />
      <table class="table-edit" width="100%">
         <tr class="subhead">
            <th colspan="2">{MODE_20080109} 
			<!-- patTemplate:gtfwgetconfig config="language" name="transaksi" / --></th>
         </tr>
        <tr id="no_bkk">              
             <th style="width: 135px;"><!-- patTemplate:gtfwgetconfig config="language" name="nomor_bukti" / --></th>
            <td>
            <!-- patTemplate:tmpl name="is_tambah" type="condition" conditionvar="IS_TAMBAH" -->
        		<!-- patTemplate:sub condition="YES" -->
				<b>(<!-- patTemplate:gtfwgetconfig config="language" name="auto_number" / -->)</b>
				<!-- /patTemplate:sub -->
        		<!-- patTemplate:sub condition="NO" -->
				<b>{NO_KKB}</b>
				<input type="hidden" name="no_kkb" id="no_kkb" value="{NO_KKB}" />
				<input type="hidden" name="unitkerja_lama" id="unitkerja_lama"
							 value="{UNITKERJA_LAMA}"/>
                                <input type="hidden" name="transTanggal_lama" id="transTanggal_lama" value="{TANGGAL_TRANS_LAMA}" />
				<!-- /patTemplate:sub -->
        	<!-- /patTemplate:tmpl -->
			</td>
        </tr>
      <!-- patTemplate:tmpl name="role" type="condition" conditionvar="WHOAMI" -->
         <!-- patTemplate:sub condition="ADMINISTRATOR" -->
        <tr>
          <th><!-- patTemplate:gtfwgetconfig config="language" name="unit" / -->/ <!-- patTemplate:gtfwgetconfig config="language" name="sub_unit" / --></th>
          <td><input type="hidden" name="unitkerja" id="unitkerja" value="{UNITKERJA}" /><input type="text" name="unitkerja_label" id="unitkerja_label" value="{UNITKERJA_LABEL}" size="40" readonly="readonly" /><input type="button"  name="but_unitkerja" onclick="bukaPopupUnitkerja('{URL_POPUP_UNITKERJA}')" value=" ... " />*</td>
        </tr>
       <!-- /patTemplate:sub -->
         <!-- patTemplate:sub condition="OPERATORUNIT" -->
        <tr>
          <th><!-- patTemplate:gtfwgetconfig config="language" name="unit" / -->/ <!-- patTemplate:gtfwgetconfig config="language" name="sub_unit" / --></th>
          <td><input type="hidden" name="unitkerja" id="unitkerja" value="{UNITKERJA}" /><input type="text" name="unitkerja_label" id="unitkerja_label" value="{UNITKERJA_LABEL}" size="40" readonly="readonly" /><input type="button"  name="but_unitkerja" onclick="bukaPopupUnitkerja('{URL_POPUP_UNITKERJA}')" value=" ... " />*</td>
        </tr>
       <!-- /patTemplate:sub -->
         <!-- patTemplate:sub condition="OPERATORSUBUNIT" -->
         <tr>
            <th><!-- patTemplate:gtfwgetconfig config="language" name="unit" / -->/ <!-- patTemplate:gtfwgetconfig config="language" name="sub_unit" / --></th>
            <td><input type="hidden" name="unitkerja" id="unitkerja" value="{UNITKERJA}" /><input type="hidden" name="unitkerja_label" id="unitkerja_label" value="{UNITKERJA_LABEL}" size="40" readonly="readonly" />{UNITKERJA_LABEL}</td>
         </tr>
       <!-- /patTemplate:sub -->
     <!-- /patTemplate:tmpl -->
        <tr style="display: none;">
          <th width="20%"><!-- patTemplate:gtfwgetconfig config="language" name="jenis_transaksi" / --></th>
          <td><!-- patTemplate:gtfwrendermodule module="combobox" submodule="combobox" action="view" name="jenis_transaksi"  / -->*</td>
        </tr>
        <tr style="display: none;">
          <th><!-- patTemplate:gtfwgetconfig config="language" name="tipe_transaksi" / --></th>
          <td><!-- patTemplate:gtfwrendermodule module="combobox" submodule="combobox" action="view" name="tipe_transaksi"  / -->*</td>
        </tr>
        <tr>
          <th><!-- patTemplate:gtfwgetconfig config="language" name="mak" / --></th>
          <td>
            <input type="hidden" name="realisasi_id" id="txt_realisasi_id" value="{REALISASI_ID}" />
            <input type="hidden" name="kegiatan_id" id="txt_kegiatan_id" value="{KEGIATAN_ID}" />
            <input type="hidden" name="akun_id" id="txt_akun_id" value="{AKUN_ID}" />
            <input type="hidden" name="akun_nama" id="txt_akun_nama" value="{AKUN_NAMA}" readonly size="35" />
            
          <input type="hidden" name="mak_lama_id" id="mak_lama_id" value="{MAK_LAMA_ID}" />
          <input type="hidden" name="mak_lama" id="mak_lama" value="{MAK_LAMA}" />
          <input type="hidden" name="mak" id="mak" value="{MAK}" />
          <input type="text" name="mak_label" id="mak_label" value="{MAK_LABEL}" size="50" readonly="readonly" {MAK_IS_DISABLED} /><input type="button" name="but_mak" id="but_mak" onclick="bukaPopupMAK('{URL_POPUP_MAK}')" value=" ... " {MAK_IS_DISABLED} /></td>
        </tr>

 <tr class="subhead">
         <th colspan="2">
            Komponen Anggaran
         </th>
      </tr>
      <tr>
         <td colspan="2" style="padding: 0px;">
            <table class="table-common" width="100%">
               <thead>
                  <tr>
                     <th colspan="2" style="text-align: center; width: 115px; vertical-align: middle; font-weight: bold;">
                        <!-- patTemplate:gtfwgetconfig config="language" name="komponen" / -->
                     </th>
                     <th style="text-align: center; vertical-align: middle; font-weight: bold; width: 115px;" rowspan="2">
                        <!-- patTemplate:gtfwgetconfig config="language" name="kode_coa" / -->
                     </th>
                     <th style="text-align: center; vertical-align: middle; font-weight: bold; width: 220px;" rowspan="2">
                        <!-- patTemplate:gtfwgetconfig config="language" name="deskripsi" / -->
                     </th>
                     <th style="text-align: center; vertical-align: middle; font-weight: bold; width: 120px;" rowspan="2">
                        <!-- patTemplate:gtfwgetconfig config="language" name="nilai" / -->
                     </th>
                  </tr>
                  <tr>
                     <th style="text-align: center; width: 50px; vertical-align: middle; font-weight: bold;">
                        <!-- patTemplate:gtfwgetconfig config="language" name="kode" / -->
                     </th>
                     <th style="text-align: center; vertical-align: middle; font-weight: bold;">
                        <!-- patTemplate:gtfwgetconfig config="language" name="nama" / -->
                     </th>                                    
                  </tr>
               </thead>
               <tbody id="KOMP_Place_Holder">
                  <tr id="empty_row">
                     <td colspan="5" style="text-align: center; font-style: italic;">
                        -- <!-- patTemplate:gtfwgetconfig config="language" name="belum_ada_yang_dipilih" / --> --
                     </td>
                  </tr>
               </tbody>
            </table>
         </td>
      </tr>
              
        <tr>
          <th><!-- patTemplate:gtfwgetconfig config="language" name="tanggal_transaksi" / --></th>
          <td>
                
                <!-- patTemplate:gtfwrendermodule module="tanggal" submodule="Tanggal" action="view" name="tanggal_transaksi" / -->
            </td>
        </tr>
        <tr style="display: none;">
          <th><!-- patTemplate:gtfwgetconfig config="language" name="due_date" / --></th>
          <td><!-- patTemplate:gtfwrendermodule module="tanggal" submodule="Tanggal" action="view" name="due_date" / --></td>
        </tr>
        <!-- tr id="no_bkk">
          <th><!-- patTemplate:gtfwgetconfig config="language" name="no" / -->.<span id='_tipe_transaksi'></span></th>
          <td><input type="text" name="no_kkb" id="no_kkb" value="{NO_KKB}" />*</td>
        </tr -->
        <tr>
          <th><!-- patTemplate:gtfwgetconfig config="language" name="no_invoice" / --></th>
          <td><input type="text" name="no_invoice" id="no_invoice" value="{NO_INVOICE}" /><input type="button" value="<!-- patTemplate:gtfwgetconfig config="language" name="simpan" / -->" name="no_invoice_simpan" id="no_invoice_simpan" onclick="tambahInvoice()" /></td>
        </tr>
      <tr>
         <td colspan="2" style="padding-left:50px">
            <table class="table-edit" width="500" id="table_invoice_list">
               <tr class="subhead">

                  <th><!-- patTemplate:gtfwgetconfig config="language" name="invoice" / --></th>
                  <th width="33"><!-- patTemplate:gtfwgetconfig config="language" name="aksi" / --></th>
               </tr>
               <tbody id="tbody_invoice_list">
                 <!-- patTemplate:tmpl name="tpl_invoice_list" type="condition" conditionvar="INVOICE_LIST_EMPTY" -->
                   <!-- patTemplate:sub condition="YES" -->
                   <tr id="invoice_empty"><td colspan="3" align="center"><em>--<!-- patTemplate:gtfwgetconfig config="language" name="data_kosong" / -->--</em></td></tr>
                   <!-- /patTemplate:sub -->
                   <!-- patTemplate:sub condition="NO" -->
                     <!-- patTemplate:tmpl name="tpl_invoice_item" -->
                     <tr class="{DATA_CLASS_NAME}">
                        <td>
                           {DATA_NOMOR}
                           <input type="hidden" name="no_invoice_list_edit" id="no_invoice_list_edit" value="{DATA_NOMOR}" />
                        </td>
                        <td>
                           <a href="javascript:void(0)" onclick="hapusInvoiceEdit(this, '{DATA_ID_DELETE}')" title="<!-- patTemplate:gtfwgetconfig config="language" name="hapus" / -->"><img src="images/button-delete.gif" alt="Hapus"/></a>
                        </td>
                   </tr>
                   <!-- /patTemplate:tmpl -->
                   <!-- /patTemplate:sub -->
                 <!-- /patTemplate:tmpl -->
               </tbody>
               
            </table>
         </td>
        </tr>
        <tr>
          <th><!-- patTemplate:gtfwgetconfig config="language" name="nominal_disetujui" / --></th>
          <td>
            <!-- patTemplate:gtfwgetconfig config="language" name="rp" / -->. 
			<input type="text" name="nominal_disetujui" id="nominal_disetujui" value="{NOMINAL_DISETUJUI}" readonly="true" style='text-align: right'  class="gvFloat"/>
            <input type="hidden" name="nominal_disetujui_hidden" id="nominal_disetujui_hidden" value="" />
            <input type="hidden" name="peng_real_id" id="peng_real_id" value="" />
          </td>
        </tr>
 <tr>
         <th>
            <!-- patTemplate:gtfwgetconfig config="language" name="nominal_realisasi" / -->
         </th>
         <td>
            <strong>
               <!-- patTemplate:gtfwgetconfig config="language" name="rp" / -->.
            </strong>
            <input type="text" name="nominal_realisasi" class="gvFloat" value="{NOMINAL_REALISASI}"  readonly />
         </td>
      </tr>        
        <tr>
          <th><!-- patTemplate:gtfwgetconfig config="language" name="nominal" / --></th>
          <td><!-- patTemplate:gtfwgetconfig config="language" name="rp" / -->. <input type="text" name="nominal" id="nominal" value="{NOMINAL}" class="gvFloat" />*</td>
        </tr>
        <tr>
          <th><!-- patTemplate:gtfwgetconfig config="language" name="uraian_transaksi" / --></th>
          <td><textarea name="catatan_transaksi" cols="50" rows="5">{CATATAN_TRANSAKSI}</textarea></td>
        </tr>
        <tr>
          <th><!-- patTemplate:gtfwgetconfig config="language" name="penanggung_jawab" / --></th>
          <td><input type="text" name="penanggung_jawab" id="penanggung_jawab" value="{PENANGGUNG_JAWAB}" size="40" />*</td>
        </tr>
        
        <tr>
          <th><!-- patTemplate:gtfwgetconfig config="language" name="penerima" / --></th>
          <td><input type="text" name="penerima" id="penerima" value="{PENERIMA}" size="40" />*</td>
        </tr>
 <tr>
         <th>
            <!-- patTemplate:gtfwgetconfig config="language" name="attachment" / -->
         </th>
         <td>
            <input type="file" name="file_attach[]" id="file_attach" />
         </td>
      </tr>
      <tr>
         <td colspan="2" style="padding-left:50px">
            <table class="table-edit" id="file_attach_table" width="500">
               <tr class="subhead">

                  <th><!-- patTemplate:gtfwgetconfig config="language" name="nama_file" / --></th>
                  <th width="33"><!-- patTemplate:gtfwgetconfig config="language" name="aksi" / --></th>
               </tr>
               <tbody id="file_attach_tbody">
                 <!-- patTemplate:tmpl name="tpl_file_list" type="condition" conditionvar="FILE_LIST_EMPTY" -->
                   <!-- patTemplate:sub condition="YES" -->
                   <tr id="file_empty"><td colspan="2" align="center"><em>--<!-- patTemplate:gtfwgetconfig config="language" name="data_kosong" / -->--</em></td></tr>
                   <!-- /patTemplate:sub -->
                   <!-- patTemplate:sub condition="NO" -->
                     <!-- patTemplate:tmpl name="tpl_file_item" -->
                     <tr class="{DATA_CLASS_NAME}">
                        <td>{DATA_NAMA}</td>
                        <td>
                           <a href="javascript:void(0)" onclick="hapusFileEdit(this, '{DATA_ID_DELETE}', '{DATA_NAMA}')" title="<!-- patTemplate:gtfwgetconfig config="language" name="hapus" / -->"><img src="images/button-delete.gif" alt="Hapus"/></a>
                        </td>
                   </tr>
                   <!-- /patTemplate:tmpl -->
                   <!-- /patTemplate:sub -->
                 <!-- /patTemplate:tmpl -->
               </tbody>
            </table>
            <br />
         </td>
      </tr>
        <tr>
          <th><!-- patTemplate:gtfwgetconfig config="language" name="skenario_auto_jurnal" / --></th>
          <td><input type="text" id="skenario_label" name="skenario_label" value="{SKENARIO_LABEL}" readonly="readonly" /><input type="hidden" name="skenario" value="{SKENARIO}" id="skenario" /><input type="button" onclick="bukaPopupSkenario('{URL_POPUP_SKENARIO}')" value=" ... " name="" />*</td>
        </tr>
      <tr>
         <td colspan="2" style="padding-left:50px">
            <table class="table-edit" id="skenario_bohong_table" width="500" style="display:none">
               <tr class="subhead">
                  <th><!-- patTemplate:gtfwgetconfig config="language" name="skenario_auto_jurnal" / --></th>
                  <th width="33"><!-- patTemplate:gtfwgetconfig config="language" name="aksi" / --></th>
               </tr>
               <tbody id="skenario_bohong_tbody">
                  <!-- <tr><td colspan="3" align="center"><em>-- Data tidak ditemukan --</em></td></tr> -->
               </tbody>
            </table>
         </td>
      </tr>
        <tr class="buttons">
         <th>&nbsp;</th>
         <td>
            <div style="display:none;"><input type="submit" name="btnsimpan" id="simpan" value=" <!-- patTemplate:gtfwgetconfig config="language" name="simpan" / -->" /></div>
            <input type="button" name="btnsimpanBohong" value=" <!-- patTemplate:gtfwgetconfig config="language" name="simpan" / --> " onclick="cekIsiForm()" />
			<a class="xhr dest_subcontent-element button" href="{URL_BATAL}" 
			title="<!-- patTemplate:gtfwgetconfig config="language" name="batal" / -->">
				<!-- patTemplate:gtfwgetconfig config="language" name="batal" / -->
			</a>
		 </td>
      </tr>
     
   </table>
</form>
<br />
<!-- div class="toolbar">
   <a class="xhr dest_subcontent-element" href="{URL_DETIL}" title="Detail Transaksi"><img src="images/button-add.gif" alt="">
   <!-- patTemplate:gtfwgetconfig config="language" name="lihat_detil_transaksi" / --></a>
</div -->
<br />
<div class="petunjuk-area">
   <h4><!-- patTemplate:gtfwgetconfig config="language" name="petunjuk" / --></h4>
   <ul>
      <li><!-- patTemplate:gtfwgetconfig config="language" name="info_wajib_diisi" / --></li>
   </ul>
</div>
<script>
showHideMAK(document.getElementById('jenis_transaksi'));
//if (document.getElementById('no_kkb').value == '') jsCheck(4);


// untuk komponen detail belanja anggaran

var patern     = /(\w+)\[(\d+)\]\[(\w+)\]/;
var setBudget  = function(el, holder_id){
   var name    = el.name.match(patern);
   var elIndex    = name[2];
   var elName     = name[3];

   var availabelBudgetEl   = document.getElementsByName('KOMP['+elIndex+'][nominal_available]')[0];
   var sisaBudgetEl        = document.getElementsByName('KOMP['+elIndex+'][nominal]')[0];
   var nominalBudget       = parseFloat(el.gvGetValue());
   var availabelBudget     = parseFloat(availabelBudgetEl.value);
   var formatedNumber      = formatCurrency(availabelBudget);
   if(nominalBudget > availabelBudget){
      alert('Nominal yang anda masukkan melebihi nominal yang tersedia '+formatedNumber);
      el.gvSetValue(availabelBudget);
   }
   
   //sisaBudgetEl.gvSetValue(parseFloat(availabelBudgetEl.value));//-parseFloat(el.gvGetValue()));
   generateBudget();
}


var generateBudget   = function(){
   var budget     = 0;
   var objBudget  = document.getElementsByName('nominal')[0];
   //var y          = parseInt(document.getElementById('txt_nominal').value);
   var holder     = document.getElementById('KOMP_Place_Holder');
   var inputElement  = holder.getElementsByTagName('input');
   var rows          = holder.getElementsByTagName('tr');
   for (var i = rows.length - 1; i >= 0; i--) {
      var el_id   = /\sdetailId_(.*?)\s/.exec(' '+rows[i].id+' ');

      if(el_id != null){
         var elBudget   = document.getElementsByName('KOMP['+el_id[1]+'][nominal]')[0];
         if(elBudget && typeof(elBudget) != 'undefined'){
            budget      += parseFloat(elBudget.gvGetValue());
         }
      }
   };

  // var z          = (budget/y)*100;
   objBudget.gvSetValue(budget);
  // document.getElementById('persentase').value=z;
}

function formatCurrency(num) {
   num      = num.toString().replace(/\$|\,/g,'');
   if(isNaN(num))
   num      = "0";
   sign     = (num == (num = Math.abs(num)));
   num      = Math.floor(num*100+0.50000000001);
   cents    = num%100;
   num      = Math.floor(num/100).toString();
   if(cents<10)
   cents    = "0" + cents;
   for (var i = 0; i < Math.floor((num.length-(1+i))/3); i++)
   num      = num.substring(0,num.length-(4*i+3))+'.'+
   num.substring(num.length-(4*i+3));
   return (((sign)?'':'-') + num + ',' + cents);
}

function clearCurrency(str){
   num      = str.toString();
   num      = num.replace(/\$|\./g, '');
   num      = num.replace(/\$|\,/g,'.');
   num      = parseFloat(num);
   return num;
}


document.getElementById('KOMP_Place_Holder').addItem = function (detailId, pId,kegdetId,kodeKomponen, namaKomponen, coaKode, deskripsi,nominal)
{
   var id = 'detailId_'+detailId;
   if (document.getElementById(id)) {
      return true;
   }
   var childNodes    = this.getElementsByTagName('tr');
   for (var i = childNodes.length - 1; i >= 0; i--) {
      if(childNodes[i].id == 'empty_row'){
         this.removeChild(childNodes[i]);
      }
   };

   var childObj   = this.getElementsByTagName('tr');
   nomor          = childObj.length;
   var tr         = document.createElement('tr');
   tr.setAttribute("id", id);
   if (nomor % 2 == 0) {
      tr.setAttribute('class', 'table-common-even');
   }


   var inputPdId          = document.createElement('input');
   inputPdId.type         = 'hidden';
   inputPdId.name         = 'KOMP['+detailId+'][pd_id]';
   inputPdId.value        = detailId;

   var inputPId          = document.createElement('input');
   inputPId.type         = 'hidden';
   inputPId.name         = 'KOMP['+detailId+'][p_id]';
   inputPId.value        = pId;
      
   var inputKegdetId          = document.createElement('input');
   inputKegdetId.type         = 'hidden';
   inputKegdetId.name         = 'KOMP['+detailId+'][kegdet_id]';
   inputKegdetId.value        = kegdetId;
   
   var inputKompKode          = document.createElement('input');
   inputKompKode.name         = 'KOMP['+detailId+'][komp_kode]';
   inputKompKode.type         = 'hidden';
   inputKompKode.value        = kodeKomponen;
   
   var inputKompNama          = document.createElement('input');
   inputKompNama.type         = 'hidden';
   inputKompNama.name         = 'KOMP['+detailId+'][komp_nama]';
   inputKompNama.value        = namaKomponen;

   var inputCoaKodeAkun           = document.createElement('input');
   inputCoaKodeAkun.type          = 'hidden';
   inputCoaKodeAkun.name          = 'KOMP[' + detailId + '][coa_kode]';
   inputCoaKodeAkun.value         = coaKode;

   var inputDeskripsi         = document.createElement('input');
   inputDeskripsi.type        = 'hidden';
   inputDeskripsi.name        = 'KOMP[' + detailId + '][deskripsi]';
   inputDeskripsi.value       = deskripsi;
   /*
   var inputNominal           = document.createElement('input');
   inputNominal.type          = 'text';
   inputNominal.value         = nominal;
   inputNominal.id            = 'komp_nominal_'+detailId;
   inputNominal.name          = 'KOMP[' + detailId + '][nominal]';
   inputNominal.className     = 'gvFloat';
   inputNominal.setAttribute('readonly', 'readonly');
   inputNominal.style.fontWeight = 'bold';
*/
   var inputNominalHidden     = document.createElement('input');
   inputNominalHidden.type    = 'hidden';
   inputNominalHidden.value   = nominal;
   inputNominalHidden.id      = 'komp_nominal_hid_'+detailId;
   inputNominalHidden.name    = 'KOMP[' + detailId + '][nominal_available]';
   inputNominalHidden.className  = 'gvFloat';

   var inputNominal     = document.createElement('input');
   inputNominal.type    = 'text';
   inputNominal.value   = 0;
   inputNominal.id      = 'komp_nominal_'+detailId;
   inputNominal.name    = 'KOMP[' + detailId + '][nominal]';
   inputNominal.style.fontWeight    = 'bold';
   inputNominal.className  = 'gvFloat';
   inputNominal.value      = nominal;
   inputNominal.setAttribute('onkeyup', 'setBudget(this, "'+this.id+'")');

   var tdKodeKomponen         = document.createElement('td');
   tdKodeKomponen.setAttribute("style", 'padding: 2px; text-align: center');
   tdKodeKomponen.innerHTML   = kodeKomponen;

   var tdNamaKomponen = document.createElement('td');
   tdNamaKomponen.setAttribute("style", 'padding: 2px; text-align: left');
   tdNamaKomponen.innerHTML = namaKomponen;

   var tdCoaKode = document.createElement('td');
   tdCoaKode.setAttribute("style", 'padding: 10px; text-align: center');
   tdCoaKode.innerHTML = coaKode;

   var tdDeskripsi = document.createElement('td');
   tdDeskripsi.setAttribute("style", 'padding: 10px; text-align: left');
   tdDeskripsi.innerHTML = deskripsi;
   /*
   var tdNominalKomponen   = document.createElement('td');
   tdNominalKomponen.style.textAlign   = 'right';
   tdNominalKomponen.style.fontWeight  = 'bold';
   tdNominalKomponen.innerHTML         = formatCurrency(nominal);
*/
   var tdNominal     = document.createElement('td');
   tdNominal.style.textAlign   = 'right';
   tdNominal.style.fontWeight  = 'bold';
   tdNominal.appendChild(inputNominal);
/*
   var tdNominal = document.createElement('td');
   tdNominal.setAttribute("style", 'padding: 2px; text-align: right;');
   tdNominal.appendChild(inputNominal);
*/
   var tdDelete = document.createElement('td');
   tdDelete.setAttribute("class", "links");
   tdDelete.setAttribute("style", 'text-align: center; display:none');
   tdDelete.innerHTML = "<a onClick=\"document.getElementById('"+this.id+"').deleteItem('" + id + "');\" title='Hapus'><img src=\"images/button-delete.gif\" alt=\"Hapus\"/></a>";

   tr.appendChild(inputPdId);
   tr.appendChild(inputPId);
   tr.appendChild(inputKegdetId);
   tr.appendChild(inputKompKode);
   tr.appendChild(inputKompNama);
   tr.appendChild(inputCoaKodeAkun);
   tr.appendChild(inputDeskripsi);
   tr.appendChild(inputNominalHidden);

   tr.appendChild(tdKodeKomponen);
   tr.appendChild(tdNamaKomponen);
   tr.appendChild(tdCoaKode);
   tr.appendChild(tdDeskripsi);
  // tr.appendChild(tdNominalKomponen);
   tr.appendChild(tdNominal);
  // tr.appendChild(tdNominal);
   // tr.appendChild(tdDelete);
   this.appendChild(tr);

   var childNode  = tdNominal.firstChild;
   do {
      if (childNode.tagName && childNode.tagName.toUpperCase() == 'INPUT'){
         gValidation20090108['.gvFloat'](childNode);
      }
   } while (childNode = childNode.nextSibling);
/*
   var childNode2  = tdNominalBudget.firstChild;
   do {
      if (childNode2.tagName && childNode2.tagName.toUpperCase() == 'INPUT'){
         gValidation20090108['.gvFloat'](childNode2);
      }
   } while (childNode2 = childNode2.nextSibling);
*/
   return true;
}

document.getElementById('KOMP_Place_Holder').deleteItem = function (id)
{
   this.removeChild(document.getElementById(id));
   var Obj = this.getElementsByTagName('tr');
   if (Obj.length == 1)
   {
      Obj[0].style.display = '';
   }
   else for (var i = 1; i < Obj.length; i++)
      Obj[i].setAttribute('class',(i % 2)?'':'table-common-even');
}

document.getElementById('KOMP_Place_Holder').deleteAllItem = function ()
{
   var Obj        = this.getElementsByTagName('tr');
   var emptyRow   = document.createElement('tr');
   emptyRow.id    = 'empty_row';
   var tdEmpty    = document.createElement('td');
   tdEmpty.setAttribute('colspan', '6');
   tdEmpty.style.textAlign    = 'center';
   tdEmpty.style.fontStyle    = 'italic';
   tdEmpty.innerHTML          = '-- Belum ada data yang dipilih! -- ';
   emptyRow.appendChild(tdEmpty);

   for (var i = Obj.length - 1; i >= 0; i--) {
      this.removeChild(Obj[i])
   };
   this.appendChild(emptyRow);
}

var dataToMount   = {KOMP_DATA};
for (var i in dataToMount){
   document.getElementById('KOMP_Place_Holder').addItem(
        dataToMount[i]['pd_id'],
        dataToMount[i]['p_id'],
        dataToMount[i]['kegdet_id'],               
        dataToMount[i]['komp_kode'],
        dataToMount[i]['komp_nama'],
        dataToMount[i]['coa_kode'],
        dataToMount[i]['deskripsi'],
        dataToMount[i]['nominal']
   );
}

</script>
<!-- /patTemplate:tmpl -->
