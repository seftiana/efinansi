<?php    require_once GTFWConfiguration::GetValue('application','docroot').    'module/approval_pencairan/business/Spm.class.php';    require_once GTFWConfiguration::GetValue('application','docroot').    'module/approval_pencairan/business/AppApprovalPencairan.class.php';    require_once GTFWConfiguration::GetValue('application', 'docroot').    'main/function/terbilang.php';        class ViewExcelSpm extends XlsResponse{        var $mWorksheets = array('Data');                function GetFileName(){            // file name            $file_name  = 'SPM_CETAK_'.date('Y-m-d', time()).'.xls';            return $file_name;        }                function ProcessRequest(){            $spmObj         = new Spm();            $numberObj      = new Number();            $Obj            = new AppApprovalPencairan();                        $listCarabayar          = $spmObj->ListCaraBayar();            $listJenisPembayaran    = $spmObj->ListJenisPembayaran();            $listSifatPembayaran    = $spmObj->ListSifatPembayaran();            $dataId                 = Dispatcher::Instance()->Decrypt($_GET['dataId']);            $spmId                  = Dispatcher::Instance()->Decrypt($_GET['spmId']);                        if (isset($spmId) AND $spmId != '')            {                # code...                $spm_data           = $spmObj->GetSpmBySpmId($spmId);                $dipa               = $spmObj->GetDipa();            }            $dataApprovalPencairan  = $Obj->GetDataById($dataId);                        $data_detil             = $spmObj->ListKegiatanByApprovalId($dataId);            $spm_pajak              = $spmObj->GetPajakSpm($spmId);            $fTitle = $this->mrWorkbook->add_format();			$fTitle->set_bold();			$fTitle->set_size(12);			$fTitle->set_align('vcenter');            $fTitle->set_align('center');                        $fColCellTitle = $this->mrWorkbook->add_format();			$fColCellTitle->set_border(0);			// $fColCellTitle->set_bold();			$fColCellTitle->set_size(10);				$fColCellTitle->set_align('center');                        $fColCellBorder = $this->mrWorkbook->add_format();            $fColCellBorder->set_border(1);            $fColCellBorder->set_size(10);				$fColCellBorder->set_align('left');                        $fColCellBorderCenter = $this->mrWorkbook->add_format();            $fColCellBorderCenter->set_border(1);            $fColCellBorderCenter->set_size(10);				$fColCellBorderCenter->set_align('center');                        $fColCellBorderCenterBold = $this->mrWorkbook->add_format();            $fColCellBorderCenterBold->set_border(1);            $fColCellBorderCenterBold->set_size(10);				$fColCellBorderCenterBold->set_align('center');            $fColCellBorderCenterBold->set_bold();                        $fColCellCurrencyFormat = $this->mrWorkbook->add_format();            $fColCellCurrencyFormat->set_border(1);            $fColCellCurrencyFormat->set_size(10);            $fColCellCurrencyFormat->set_align('right');                        $this->mWorksheets['Data']->write_string(0,0,GTFWConfiguration::GetValue('organization', 'kementerian_lembaga_nama'),$fTitle);            $this->mWorksheets['Data']->merge_cells(0,0,0,3);            $this->mWorksheets['Data']->write_string(1,0,'SURAT PERINTAH MEMBAYAR',$fTitle);            $this->mWorksheets['Data']->merge_cells(1,0,1,3);            $this->mWorksheets['Data']->write_string(2,0,'Tanggal : '.date_format(date_create($data['data_spm']['spm_tanggal']), 'd-m-Y').'  Nomor :'.$spm_data['spm_nomor'],$fColCellTitle);            $this->mWorksheets['Data']->merge_cells(2,0,2,3);                        $this->mWorksheets['Data']->write(3,0,'Kuasa Bendara Umum Negara, KPPN');            $this->mWorksheets['Data']->write_string(3,1,GTFWConfiguration::GetValue('organization', 'city').' ('.GTFWConfiguration::GetValue('organization', 'city_number').')');            $this->mWorksheets['Data']->merge_cells(3,1,3,3);            $this->mWorksheets['Data']->write(4,0,'Agar melakukan pembayaran sejumlah');            $this->mWorksheets['Data']->write_number(4,1,$spm_data['spm_nominal']);            $this->mWorksheets['Data']->merge_cells(4,1,4,3);            $this->mWorksheets['Data']->write_string(5,0,'***'.$numberObj->terbilang($spm_data['spm_nominal'],2).'***');            $this->mWorksheets['Data']->merge_cells(5,0,5,3);            $this->mWorksheets['Data']->write_string(6,0,'Cara Pembayaran : '.$spm_data['cara_bayar_kode'].' - '.$spm_data['cara_bayar_nama']);            $this->mWorksheets['Data']->merge_cells(6,0,6,1);            $this->mWorksheets['Data']->write_string(6,2,'Tahun Anggaran : '. $dataApprovalPencairan['tahun_anggaran_label']);            $this->mWorksheets['Data']->merge_Cells(6,2,6,3);                        $this->mWorksheets['Data']->write_string(7,0,'Dasar Pembayaran',$fColCellBorderCenterBold);            $this->mWorksheets['Data']->write_String(7,1,'Satker',$fColCellBorderCenterBold);            $this->mWorksheets['Data']->write_string(7,2,'KWN',$fColCellBorderCenterBold);            $this->mWorksheets['Data']->write_string(7,3,'Nama Satker',$fColCellBorderCenterBold);                        $dipa   = wordwrap($dipa['dipa_nama'].' Tanggal :'.$this->_dateToIndo($dipa['dipa_tanggal']));            $this->mWorksheets['Data']->write_string(8,0,$dipa,$fColCellBorderCenter);            $this->mWorksheets['Data']->write_number(8,1,GTFWConfiguration::GetValue('organization', 'satker_no'),$fColCellBorderCenter);            $this->mWorksheets['Data']->write_string(8,2,'KD',$fColCellBorderCenter);            $this->mWorksheets['Data']->write_string(8,3,GTFWConfiguration::GetValue('organization', 'company_name'),$fColCellBorderCenter);                        $this->mWorksheets['Data']->write_string(10,1,'Fungsi, Sub Fungsi, Unit Es.I, Program');            $this->mWorksheets['Data']->merge_cells(10,1,10,3);                        $this->mWorksheets['Data']->write_string(11,1,GTFWConfiguration::GetValue('organization', 'fungsi_no').'.'.GTFWConfiguration::GetValue('organization', 'subfungsi_no').'.'.GTFWConfiguration::GetValue('organization', 'unit_org_eselon_no').'.'.GTFWConfiguration::GetValue('organization', 'program_no'));                        $this->mWorksheets['Data']->merge_cells(11,1,11,3);                        $this->mWorksheets['Data']->write_string(12,1,'Kegiatan, Output, Sub Kelompok Akun');            $this->mWorksheets['Data']->merge_cells(12,1,12,3);            $this->mWorksheets['Data']->write_string(13,1,$data_detil[0]['keg_nomor'].'.'.$data_detil[0]['output_kode'].'.'.substr($data_detil[0]['mak_kode'],0,4));            $this->mWorksheets['Data']->merge_cells(13,1,13,3);                        $this->mWorksheets['Data']->write_string(14,1,'Jenis Pembayaran');            $this->mWorksheets['Data']->merge_cells(14,1,14,2);            $this->mWorksheets['Data']->write_string(14,3,$spm_data['jenis_bayar_kode'].' - '.$spm_data['jenis_bayar_nama']);            $this->mWorksheets['Data']->write_string(15,1,'Sifat Pembayaran');            $this->mWorksheets['Data']->merge_cells(15,1,15,2);            $this->mWorksheets['Data']->write_string(15,3,$spm_data['sifat_bayar_kode'].' - '.$spm_data['sifat_bayar_nama']);                        $this->mWorksheets['Data']->write_string(17,0,'PENGELUARAN',$fColCellBorderCenter);            $this->mWorksheets['Data']->merge_cells(17,0,17,3);            $this->mWorksheets['Data']->write_string(17,0,'POTONGAN',$fColCellBorderCenter);            $this->mWorksheets['Data']->merge_cells(17,4,17,5);            $this->mWorksheets['Data']->write_string(18,0,'Akun',$fColCellBorderCenter);            $this->mWorksheets['Data']->write_string(18,1,'COA',$fColCellBorderCenter);            $this->mWorksheets['Data']->write_string(18,2,'Jumlah Uang',$fColCellBorderCenter);            $this->mWorksheets['Data']->merge_cells(18,2,18,3);            $this->mWorksheets['Data']->write_string(18,4,'Lemb/Unit/Lok/MAP',$fColCellBorderCenter);            $this->mWorksheets['Data']->write_string(18,5,'Jumlah Uang',$fColCellBorderCenter);            $row_cells = 19;            for ($i = 0; $i < count($data_detil); $i++)            {                # code...                $this->mWorksheets['Data']->write_string($row_cells,0,$data_detil[$i]['mak_kode'],$fColCellBorderCenter);                $this->mWorksheets['Data']->write_string($row_cells,1,$data_detil[$i]['coa_nama'],$fColCellBorderCenter);                $this->mWorksheets['Data']->write_number($row_cells,2,$data_detil[$i]['spp_ini'],$fColCellCurrencyFormat);                $this->mWorksheets['Data']->merge_cells($row_cells,2,$row_cells,3);                $nominal[$i]                    = $data_detil[$i]['spp_ini'];                if($i<1)                {                    $nominal_pajak[$i]               = $listPajak['nominal_pajak'];                    $this->mWorksheets['Data']->write_string($row_cells,4,GTFWConfiguration::GetValue('organization','kementerian_lembaga_no').'/'.GTFWConfiguration::GetValue('organization','unit_org_eselon_no').'/'.GTFWConfiguration::GetValue('organization','nomor_lokasi').'/'.$spm_pajak['kode_pajak'],$fColCellBorderCenter);                    $this->mWorksheets['Data']->write_number($row_cells,5,$spm_pajak['nominal_pajak'],$fColCellCurrencyFormat);                }                else                {                    $this->mWorksheets['Data']->write_string($row_cells,4,'',$fColCellBorderCenter);                    $this->mWorksheets['Data']->write_number($row_cells,5,'',$fColCellCurrencyFormat);                    $nominal_pajak[$i]               = 0;                }                $row_cells +=1;            }            $last_row   = ($row_cells+1)-1;            $this->mWorksheets['Data']->write($last_row,0,'Jumlah Pengeluaran',$fColCellBorderCenter);            $this->mWorksheets['Data']->write($last_row,1,array_sum($nominal),$fColCellCurrencyFormat);            $this->mWorksheets['Data']->merge_cells($last_row,1,$last_row,3);            $this->mWorksheets['Data']->write($last_row,4,'Jumlah Pengeluaran',$fColCellBorderCenter);            $this->mWorksheets['Data']->write($last_row,5,array_sum($nominal_pajak),$fColCellCurrencyFormat);                        $this->mWorksheets['Data']->write_string($last_row+1,0,'Kepada');            $this->mWorksheets['Data']->merge_cells($last_row+1,0,$last_row+1,1);            $this->mWorksheets['Data']->write_string($last_row+1,2,$spm_data['spm_nama']);            $this->mWorksheets['Data']->merge_cells($last_row+1,2,$last_row+1,3);                        $this->mWorksheets['Data']->write_string($last_row+2,0,'NPWP');            $this->mWorksheets['Data']->merge_cells($last_row+2,0,$last_row+2,1);            $this->mWorksheets['Data']->write_string($last_row+2,2,$spm_data['spm_npwp']);            $this->mWorksheets['Data']->merge_cells($last_row+2,2,$last_row+2,3);                        $this->mWorksheets['Data']->write_string($last_row+3,0,'Nomor/Nama Rek');            $this->mWorksheets['Data']->merge_cells($last_row+3,0,$last_row+3,1);            $this->mWorksheets['Data']->write_string($last_row+3,2,$spm_data['spm_rekening']);            $this->mWorksheets['Data']->merge_cells($last_row+3,2,$last_row+3,3);                        $this->mWorksheets['Data']->write_string($last_row+4,0,'Bank/Pos');            $this->mWorksheets['Data']->merge_cells($last_row+4,0,$last_row+4,1);            $this->mWorksheets['Data']->write_string($last_row+4,2,$spm_data['spm_bank']);            $this->mWorksheets['Data']->merge_cells($last_row+4,2,$last_row+4,3);                        $this->mWorksheets['Data']->write_string($last_row+5,0,'Uraian');            $this->mWorksheets['Data']->merge_cells($last_row+5,0,$last_row+5,1);            $this->mWorksheets['Data']->write_string($last_row+5,2,$spm_data['spm_keterangan']);            $this->mWorksheets['Data']->merge_cells($last_row+5,2,$last_row+5,3);                        $this->mWorksheets['Data']->write_string($last_row+7,2,GTFWConfiguration::GetValue('organization', 'city').', '.$this->_dateToIndo(date('Y-m-d', time())));            $this->mWorksheets['Data']->merge_cells($last_row+7,2,$last_row+7,3);                        $this->mWorksheets['Data']->write_string($last_row+8,2,'A.n. Kuasa Pengguna Anggaran');            $this->mWorksheets['Data']->merge_cells($last_row+8,2,$last_row+8,3);                        $this->mWorksheets['Data']->write_string($last_row+9,2,'PEJABAT PENERBIT SPM');            $this->mWorksheets['Data']->merge_cells($last_row+9,2,$last_row+9,3);                        $this->mWorksheets['Data']->write_string($last_row+14,2,GTFWConfiguration::GetValue('organization', 'pejabat_penerbit_spm'));            $this->mWorksheets['Data']->merge_cells($last_row+14,2,$last_row+14,3);            $this->mWorksheets['Data']->write_string($last_row+15,2,'NIP.'.GTFWConfiguration::GetValue('organization', 'pejabat_penerbit_spm_nip'));            $this->mWorksheets['Data']->merge_cells($last_row+15,2,$last_row+15,3);        }                function _dateToIndo($tanggal){            list($year,$month,$day) = explode('-',date_format(date_create($tanggal),'Y-m-d'));            $bulan_array = array(                                '01' => 'Januari',                                '02' => 'Februari',                                '03' => 'Maret',                                '04' => 'April',                                '05' => 'Mei',                                '06' => 'Juni',                                '07' => 'Juli',                                '08' => 'Agustus',                                '09' => 'September',                                '10' => 'Oktober',                                '11' => 'Nopember',                                '12' => 'Desember'                                );            $date   = $day.' '.$bulan_array[$month].' '.$year;                        return $date;        }    }?>
